/* Includes ------------------------------------------------------------------*/
#include  "stm32f10x_conf.h"
#include  "Table.h"


/* Private typedef -----------------------------------------------------------*/
#define   _MinRPM                                   25
#define   _MaxRPM                                   140
#define   _MinGeneratorCurrent                      5
#define   _MaxGeneratorCurrent                      200

//Current(mA) Watts(*10)
const unsigned short EM_CW[24][31] = {  
    //0	    50	100	    150	    200	    250	    300	    350	    400	    450	    500	    550	    600	    650	    700	    750	    800	    850	    900	    950	    1000	1050	1100	1150	1200	1250	1300	1350	1400	1450	1500	
    {0 ,	2 ,	7 , 	17 ,	31 ,	50 ,	71 ,	99 ,	132 ,	169 ,	209 ,	254 ,	303 ,	355 ,	409 ,	461 ,	515 ,	565 ,	615 ,	663 ,	707 ,	748 ,	785 ,	819 ,	849 ,	879 ,	909 ,	935 ,	961 ,	984 ,	1004  },	//25
    {0 ,	3 ,	10 ,	22 ,	40 ,	61 ,	95 ,	130 ,	174 ,	220 ,	274 ,	331 ,	397 ,	462 ,	531 ,	599 ,	666 ,	736 ,	804 ,	866 ,	926 ,	976 ,	1026 ,	1076 ,	1116 ,	1156 ,	1196 ,	1236 ,	1276 ,	1306 ,	1336  },	//30
    {0 ,	3 ,	12 ,	28 ,	50 ,	79 ,	117 ,	161 ,	213 ,	273 ,	337 ,	412 ,	490 ,	568 ,	655 ,	740 ,	829 ,	916 ,	987 ,	1067 ,	1147 ,	1217 ,	1287 ,	1357 ,	1417 ,	1467 ,	1517 ,	1567 ,	1607 ,	1657 ,	1697  },	//35
    {0 ,	2 ,	14 ,	33 ,	58 ,	96 ,	141 ,	195 ,	256 ,	327 ,	408 ,	494 ,	591 ,	684 ,	787 ,	894 ,	988 ,	1098 ,	1198 ,	1288 ,	1388 ,	1478 ,	1568 ,	1648 ,	1718 ,	1788 ,	1848 ,	1908 ,	1968 ,	2018 ,	2078  },	//40
    {0 ,	3 ,	16 ,	38 ,	71 ,	114 ,	168 ,	233 ,	301 ,	386 ,	481 ,	581 ,	688 ,	803 ,	925 ,	1039 ,	1159 ,	1279 ,	1399 ,	1519 ,	1629 ,	1739 ,	1839 ,	1939 ,	2029 ,	2119 ,	2199 ,	2269 ,	2339 ,	2399 ,	2459  },	//45
    {0 ,	3 ,	17 ,	44 ,	81 ,	131 ,	195 ,	266 ,	351 ,	448 ,	554 ,	674 ,	792 ,	918 ,	1058 ,	1198 ,	1338 ,	1478 ,	1608 ,	1748 ,	1888 ,	2018 ,	2138 ,	2248 ,	2358 ,	2458 ,	2548 ,	2638 ,	2718 ,	2798 ,	2868  },	//50
    {0 ,	4 ,	22 ,	51 ,	93 ,	150 ,	217 ,	298 ,	392 ,	498 ,	613 ,	741 ,	885 ,	1019 ,	1179 ,	1339 ,	1489 ,	1639 ,	1799 ,	1949 ,	2099 ,	2249 ,	2389 ,	2529 ,	2659 ,	2779 ,	2889 ,	2999 ,	3099 ,	3189 ,	3279  },	//55
    {0 ,	5 ,	24 ,	57 ,	105 ,	163 ,	244 ,	337 ,	442 ,	561 ,	694 ,	844 ,	989 ,	1159 ,	1329 ,	1509 ,	1679 ,	1859 ,	2039 ,	2209 ,	2379 ,	2549 ,	2709 ,	2859 ,	2999 ,	3149 ,	3279 ,	3389 ,	3509 ,	3619 ,	3719  },	//60
    {0 ,	4 ,	26 ,	64 ,	116 ,	186 ,	272 ,	376 ,	494 ,	626 ,	773 ,	928 ,	1098 ,	1278 ,	1468 ,	1658 ,	1858 ,	2058 ,	2248 ,	2428 ,	2618 ,	2808 ,	2988 ,	3158 ,	3328 ,	3478 ,	3638 ,	3778 ,	3898 ,	4018 ,	4128  },	//65
    {0 ,	5 ,	28 ,	71 ,	130 ,	208 ,	302 ,	413 ,	540 ,	682 ,	835 ,	1007 ,	1197 ,	1387 ,	1587 ,	1787 ,	1997 ,	2207 ,	2417 ,	2627 ,	2837 ,	3037 ,	3247 ,	3427 ,	3607 ,	3787 ,	3957 ,	4117 ,	4257 ,	4397 ,	4517  },	//70
    {0 ,	4 ,	30 ,	77 ,	146 ,	231 ,	330 ,	453 ,	593 ,	754 ,	916 ,	1106 ,	1306 ,	1516 ,	1736 ,	1966 ,	2206 ,	2446 ,	2676 ,	2896 ,	3126 ,	3346 ,	3566 ,	3766 ,	3966 ,	4156 ,	4336 ,	4516 ,	4676 ,	4826 ,	4976  },	//75
    {0 ,	6 ,	37 ,	88 ,	160 ,	250 ,	357 ,	482 ,	636 ,	810 ,	985 ,	1195 ,	1405 ,	1645 ,	1895 ,	2125 ,	2375 ,	2635 ,	2865 ,	3115 ,	3365 ,	3595 ,	3815 ,	4065 ,	4285 ,	4495 ,	4685 ,	4875 ,	5065 ,	5235 ,	5405  },	//80
    {0 ,	7 ,	38 ,	92 ,	163 ,	263 ,	380 ,	516 ,	695 ,	862 ,	1062 ,	1282 ,	1512 ,	1752 ,	2012 ,	2272 ,	2532 ,	2792 ,	3062 ,	3322 ,	3582 ,	3832 ,	4082 ,	4322 ,	4562 ,	4782 ,	5012 ,	5232 ,	5422 ,	5612 ,	5792  },	//85
    {0 ,	8 ,	40 ,	99 ,	177 ,	289 ,	414 ,	563 ,	732 ,	921 ,	1131 ,	1361 ,	1601 ,	1861 ,	2121 ,	2391 ,	2671 ,	2951 ,	3241 ,	3521 ,	3801 ,	4061 ,	4321 ,	4581 ,	4821 ,	5061 ,	5301 ,	5541 ,	5761 ,	5971 ,	6181  },	//90
    {0 ,	6 ,	42 ,	104 ,	190 ,	302 ,	434 ,	597 ,	783 ,	978 ,	1198 ,	1438 ,	1718 ,	1998 ,	2278 ,	2568 ,	2868 ,	3158 ,	3458 ,	3768 ,	4058 ,	4348 ,	4628 ,	4918 ,	5188 ,	5438 ,	5688 ,	5948 ,	6168 ,	6388 ,	6568  },	//95
    {0 ,	4 ,	44 ,	109 ,	202 ,	324 ,	472 ,	651 ,	836 ,	1056 ,	1296 ,	1586 ,	1846 ,	2156 ,	2456 ,	2766 ,	3086 ,	3406 ,	3716 ,	4036 ,	4356 ,	4676 ,	4966 ,	5256 ,	5536 ,	5806 ,	6066 ,	6326 ,	6556 ,	6776 ,	6956  },	//100
    {0 ,	7 ,	44 ,	116 ,	210 ,	339 ,	495 ,	682 ,	873 ,	1103 ,	1353 ,	1633 ,	1933 ,	2243 ,	2553 ,	2883 ,	3193 ,	3533 ,	3863 ,	4183 ,	4513 ,	4843 ,	5163 ,	5473 ,	5753 ,	6063 ,	6343 ,	6603 ,	6863 ,	7093 ,	7343  },	//105
    {0 ,	7 ,	53 ,	125 ,	226 ,	362 ,	521 ,	706 ,	910 ,	1160 ,	1420 ,	1700 ,	2000 ,	2320 ,	2650 ,	2990 ,	3330 ,	3690 ,	4030 ,	4370 ,	4710 ,	5060 ,	5390 ,	5710 ,	6040 ,	6330 ,	6640 ,	6930 ,	7200 ,	7450 ,	7740  },	//110
    {0 ,	5 ,	53 ,	129 ,	239 ,	380 ,	556 ,	756 ,	978 ,	1228 ,	1508 ,	1808 ,	2128 ,	2478 ,	2828 ,	3188 ,	3558 ,	3928 ,	4278 ,	4648 ,	5008 ,	5378 ,	5718 ,	6068 ,	6408 ,	6718 ,	7018 ,	7308 ,	7588 ,	7858 ,	8128  },	//115
    {0 ,	3 ,	50 ,	135 ,	256 ,	403 ,	582 ,	794 ,	1034 ,	1304 ,	1604 ,	1924 ,	2264 ,	2604 ,	2994 ,	3384 ,	3774 ,	4144 ,	4534 ,	4924 ,	5294 ,	5674 ,	6044 ,	6414 ,	6754 ,	7054 ,	7394 ,	7674 ,	7944 ,	8234 ,	8524  },	//120
    {0 ,	5 ,	52 ,	138 ,	266 ,	423 ,	604 ,	810 ,	1070 ,	1350 ,	1660 ,	1980 ,	2340 ,	2720 ,	3100 ,	3490 ,	3890 ,	4280 ,	4680 ,	5080 ,	5470 ,	5830 ,	6210 ,	6570 ,	6940 ,	7290 ,	7630 ,	7970 ,	8260 ,	8580 ,	8920  },	//125
    {0 ,	6 ,	57 ,	147 ,	273 ,	433 ,	629 ,	845 ,	1105 ,	1395 ,	1715 ,	2055 ,	2425 ,	2835 ,	3245 ,	3645 ,	4045 ,	4475 ,	4885 ,	5295 ,	5725 ,	6115 ,	6505 ,	6885 ,	7265 ,	7615 ,	7975 ,	8335 ,	8655 ,	8955 ,	9315  },	//130
    {0 ,	3 ,	58 ,	148 ,	285 ,	460 ,	667 ,	902 ,	1172 ,	1482 ,	1812 ,	2192 ,	2572 ,	2992 ,	3412 ,	3842 ,	4272 ,	4702 ,	5142 ,	5572 ,	5992 ,	6422 ,	6822 ,	7222 ,	7592 ,	7972 ,	8302 ,	8642 ,	8992 ,	9352 ,	9712  },	//135
    {0 ,	5 ,	62 ,	167 ,	311 ,	485 ,	699 ,	939 ,	1229 ,	1559 ,	1899 ,	2329 ,	2719 ,	3149 ,	3579 ,	4019 ,	4459 ,	4899 ,	5319 ,	5739 ,	6159 ,	6569 ,	6979 ,	7379 ,	7799 ,	8189 ,	8579 ,	8919 ,	9319 ,	9719 ,	10119  }	//140 
} ;  

//Current(mA) Watts(*10)
const unsigned short GE_CW[24][39] = {
    //0	    50	    100	    150	    200	    250	    300	    350	    400	    450	    500	    550	    600	    650	    700	    750	    800	    850	    900	    950	    1000	1050	1100	1150	1200	1250	1300	1350	1400	1450	1500	1550	1600	1650	1700	1750	1800	1850	1900	
    {0 ,	11 ,	22 ,	39 ,	55 ,	71 ,	87 ,	87 ,	87 ,	87 ,	87 ,	87 ,	87 ,	87 ,	87 ,	87 ,	87 ,	87 ,	87 ,	87 ,	87 ,	87 ,	87 ,	87 ,	87 ,	87 ,	87 ,	87 ,	87 ,	87 ,	87 ,	87 ,	87 ,	87 ,	87 ,	87 ,	87 ,	87 ,	87 },	//25
    {0 ,	12 ,	19 ,	39 ,	58 ,	78 ,	97 ,	117 ,	136 ,	155 ,	174 ,	193 ,	211 ,	230 ,	248 ,	267 ,	267 ,	267 ,	267 ,	267 ,	267 ,	267 ,	267 ,	267 ,	267 ,	267 ,	267 ,	267 ,	267 ,	267 ,	267 ,	267 ,	267 ,	267 ,	267 ,	267 ,	267 ,	267 ,	267 },	//30
    {0 ,	5 ,	    16 ,	38 ,	59 ,	83 ,	105 ,	128 ,	148 ,	169 ,	191 ,	211 ,	230 ,	253 ,	272 ,	295 ,	316 ,	336 ,	357 ,	378 ,	402 ,	422 ,	444 ,	466 ,	487 ,	509 ,	531 ,	553 ,	553 ,	553 ,	553 ,	553 ,	553 ,	553 ,	553 ,	553 ,	553 ,	553 ,	553 },	//35
    {0 ,	4 ,	    22 ,	47 ,	72 ,	97 ,	122 ,	146 ,	171 ,	193 ,	216 ,	240 ,	264 ,	287 ,	312 ,	335 ,	359 ,	383 ,	408 ,	432 ,	459 ,	483 ,	509 ,	531 ,	555 ,	579 ,	603 ,	628 ,	653 ,	675 ,	700 ,	725 ,	750 ,	774 ,	796 ,	796 ,	796 ,	796 ,	796 },	//40
    {0 ,	12 ,	37 ,	65 ,	95 ,	122 ,	151 ,	179 ,	207 ,	233 ,	259 ,	285 ,	313 ,	339 ,	364 ,	390 ,	416 ,	443 ,	470 ,	498 ,	523 ,	552 ,	577 ,	605 ,	634 ,	662 ,	685 ,	713 ,	741 ,	771 ,	798 ,	824 ,	852 ,	881 ,	908 ,	934 ,	959 ,	984 ,	984 },	//45
    {0 ,	14 ,	47 ,	78 ,	109 ,	141 ,	172 ,	200 ,	231 ,	260 ,	289 ,	318 ,	343 ,	372 ,	401 ,	430 ,	458 ,	489 ,	518 ,	546 ,	577 ,	609 ,	640 ,	673 ,	703 ,	733 ,	770 ,	794 ,	826 ,	856 ,	881 ,	911 ,	936 ,	971 ,	997 ,	997 ,	997 ,	997 ,	997 },	//50
    {0 ,	10 ,	47 ,	81 ,	115 ,	149 ,	182 ,	214 ,	246 ,	276 ,	307 ,	337 ,	367 ,	397 ,	429 ,	462 ,	494 ,	527 ,	561 ,	594 ,	628 ,	665 ,	695 ,	731 ,	764 ,	795 ,	829 ,	862 ,	899 ,	929 ,	957 ,	957 ,	957 ,	957 ,	957 ,	957 ,	957 ,	957 ,	957 },	//55
    {0 ,	5 ,	    42 ,	81 ,	118 ,	156 ,	190 ,	227 ,	262 ,	299 ,	331 ,	366 ,	400 ,	432 ,	466 ,	501 ,	536 ,	567 ,	605 ,	643 ,	680 ,	715 ,	753 ,	790 ,	829 ,	863 ,	900 ,	900 ,	900 ,	900 ,	900 ,	900 ,	900 ,	900 ,	900 ,	900 ,	900 ,	900 ,	900 },	//60
    {0 ,	7 ,	    48 ,	88 ,	128 ,	167 ,	204 ,	245 ,	283 ,	323 ,	357 ,	394 ,	431 ,	465 ,	500 ,	534 ,	570 ,	607 ,	648 ,	684 ,	723 ,	759 ,	799 ,	836 ,	875 ,	875 ,	875 ,	875 ,	875 ,	875 ,	875 ,	875 ,	875 ,	875 ,	875 ,	875 ,	875 ,	875 ,	875 },	//65
    {0 ,	9 ,	    52 ,	95 ,	139 ,	178 ,	218 ,	263 ,	299 ,	344 ,	379 ,	418 ,	456 ,	493 ,	532 ,	567 ,	606 ,	648 ,	685 ,	729 ,	768 ,	809 ,	850 ,	850 ,	850 ,	850 ,	850 ,	850 ,	850 ,	850 ,	850 ,	850 ,	850 ,	850 ,	850 ,	850 ,	850 ,	850 ,	850 },	//70
    {0 ,	5 ,	    52 ,	99 ,	145 ,	187 ,	230 ,	275 ,	314 ,	362 ,	403 ,	444 ,	482 ,	519 ,	562 ,	607 ,	648 ,	690 ,	731 ,	782 ,	807 ,	850 ,	850 ,	850 ,	850 ,	850 ,	850 ,	850 ,	850 ,	850 ,	850 ,	850 ,	850 ,	850 ,	850 ,	850 ,	850 ,	850 ,	850 },	//75
    {0 ,	18 ,	70 ,	121 ,	168 ,	216 ,	264 ,	308 ,	353 ,	403 ,	436 ,	477 ,	519 ,	564 ,	607 ,	657 ,	701 ,	745 ,	791 ,	830 ,	866 ,	866 ,	866 ,	866 ,	866 ,	866 ,	866 ,	866 ,	866 ,	866 ,	866 ,	866 ,	866 ,	866 ,	866 ,	866 ,	866 ,	866 ,	866 },	//80
    {0 ,	24 ,	80 ,	131 ,	181 ,	231 ,	284 ,	334 ,	382 ,	433 ,	480 ,	529 ,	567 ,	614 ,	655 ,	699 ,	746 ,	795 ,	844 ,	889 ,	938 ,	938 ,	938 ,	938 ,	938 ,	938 ,	938 ,	938 ,	938 ,	938 ,	938 ,	938 ,	938 ,	938 ,	938 ,	938 ,	938 ,	938 ,	938 },	//85
    {0 ,	32 ,	88 ,	143 ,	195 ,	247 ,	298 ,	347 ,	398 ,	451 ,	499 ,	550 ,	597 ,	646 ,	695 ,	741 ,	789 ,	830 ,	876 ,	876 ,	876 ,	876 ,	876 ,	876 ,	876 ,	876 ,	876 ,	876 ,	876 ,	876 ,	876 ,	876 ,	876 ,	876 ,	876 ,	876 ,	876 ,	876 ,	876 },	//90
    {0 ,	41 ,	102 ,	157 ,	215 ,	267 ,	323 ,	380 ,	433 ,	490 ,	536 ,	589 ,	638 ,	683 ,	737 ,	789 ,	840 ,	889 ,	889 ,	889 ,	889 ,	889 ,	889 ,	889 ,	889 ,	889 ,	889 ,	889 ,	889 ,	889 ,	889 ,	889 ,	889 ,	889 ,	889 ,	889 ,	889 ,	889 ,	889 },	//95
    {0 ,	35 ,	98 ,	157 ,	218 ,	273 ,	333 ,	391 ,	447 ,	508 ,	560 ,	611 ,	665 ,	721 ,	775 ,	828 ,	880 ,	880 ,	880 ,	880 ,	880 ,	880 ,	880 ,	880 ,	880 ,	880 ,	880 ,	880 ,	880 ,	880 ,	880 ,	880 ,	880 ,	880 ,	880 ,	880 ,	880 ,	880 ,	880 },	//100
    {0 ,	31 ,	97 ,	164 ,	222 ,	285 ,	343 ,	403 ,	461 ,	528 ,	583 ,	637 ,	688 ,	749 ,	806 ,	865 ,	865 ,	865 ,	865 ,	865 ,	865 ,	865 ,	865 ,	865 ,	865 ,	865 ,	865 ,	865 ,	865 ,	865 ,	865 ,	865 ,	865 ,	865 ,	865 ,	865 ,	865 ,	865 ,	865 },	//105
    {0 ,	40 ,	110 ,	174 ,	236 ,	295 ,	357 ,	425 ,	478 ,	546 ,	598 ,	657 ,	712 ,	769 ,	823 ,	884 ,	884 ,	884 ,	884 ,	884 ,	884 ,	884 ,	884 ,	884 ,	884 ,	884 ,	884 ,	884 ,	884 ,	884 ,	884 ,	884 ,	884 ,	884 ,	884 ,	884 ,	884 ,	884 ,	884 },	//110
    {0 ,	67 ,	139 ,	205 ,	265 ,	329 ,	392 ,	458 ,	519 ,	583 ,	637 ,	694 ,	769 ,	864 ,	895 ,	895 ,	895 ,	895 ,	895 ,	895 ,	895 ,	895 ,	895 ,	895 ,	895 ,	895 ,	895 ,	895 ,	895 ,	895 ,	895 ,	895 ,	895 ,	895 ,	895 ,	895 ,	895 ,	895 ,	895 },	//115
    {0 ,	79 ,	155 ,	225 ,	294 ,	356 ,	420 ,	495 ,	552 ,	619 ,	678 ,	740 ,	804 ,	874 ,	874 ,	874 ,	874 ,	874 ,	874 ,	874 ,	874 ,	874 ,	874 ,	874 ,	874 ,	874 ,	874 ,	874 ,	874 ,	874 ,	874 ,	874 ,	874 ,	874 ,	874 ,	874 ,	874 ,	874 ,	874 },	//120
    {0 ,	60 ,	141 ,	210 ,	279 ,	346 ,	412 ,	487 ,	552 ,	622 ,	681 ,	745 ,	819 ,	819 ,	819 ,	819 ,	819 ,	819 ,	819 ,	819 ,	819 ,	819 ,	819 ,	819 ,	819 ,	819 ,	819 ,	819 ,	819 ,	819 ,	819 ,	819 ,	819 ,	819 ,	819 ,	819 ,	819 ,	819 ,	819 },	//125
    {0 ,	59 ,	140 ,	213 ,	289 ,	354 ,	420 ,	499 ,	568 ,	635 ,	695 ,	764 ,	834 ,	834 ,	834 ,	834 ,	834 ,	834 ,	834 ,	834 ,	834 ,	834 ,	834 ,	834 ,	834 ,	834 ,	834 ,	834 ,	834 ,	834 ,	834 ,	834 ,	834 ,	834 ,	834 ,	834 ,	834 ,	834 ,	834 },	//130
    {0 ,	59 ,	148 ,	214 ,	292 ,	365 ,	433 ,	514 ,	591 ,	669 ,	739 ,	808 ,	870 ,	870 ,	870 ,	870 ,	870 ,	870 ,	870 ,	870 ,	870 ,	870 ,	870 ,	870 ,	870 ,	870 ,	870 ,	870 ,	870 ,	870 ,	870 ,	870 ,	870 ,	870 ,	870 ,	870 ,	870 ,	870 ,	870 },	//135
    {0 ,	18 ,	112 ,	190 ,	271 ,	348 ,	417 ,	498 ,	575 ,	648 ,	723 ,	790 ,	790 ,	790 ,	790 ,	790 ,	790 ,	790 ,	790 ,	790 ,	790 ,	790 ,	790 ,	790 ,	790 ,	790 ,	790 ,	790 ,	790 ,	790 ,	790 ,	790 ,	790 ,	790 ,	790 ,	790 ,	790 ,	790 ,	790 }	//140
};

/* Private function prototypes -----------------------------------------------*/
/* Private functions ---------------------------------------------------------*/
/*******************************************************************************
* Function Name  : 轉換控制電流(電磁鐵)
* Description    : 
* Input          : 
* Output         : 
* Return         : EM_CW
*******************************************************************************/
unsigned short Table_GetElectromagnetCurrent(unsigned short Watts,unsigned short Rpm)
{
    unsigned short RetValue = 0 ;
    unsigned char x = 0, y = 0, y1 = 0 ;
    unsigned short EMH = 0,EML = 0;
    unsigned char  B = 0 ;
    
    if( Watts != 0 )
    {
        if( Rpm >= 25 )
        {
            if( Rpm > 140 )
                y = (140-25)/5 ;
            else  
            {
                y = (Rpm-25)/5 ;
                if( ((Rpm-25)%5) != 0 )
                {
                    y1 = y+1 ;
                    B = (Rpm-25)%5 ;
                }
            }
        }
        
        for( x = 0 ; x < 31 ; x++ )
        {
            if( EM_CW[y][x] > Watts )
            {
                if( x >= 1 )
                {
                    EML = ((x-1) * 5) + ((Watts-EM_CW[y][(x-1)])/((EM_CW[y][x]-EM_CW[y][(x-1)])/5)) ;
                }
                else
                {
                    EML = 0 ;
                }
                break ; 
            }
            else
            {
                if( EM_CW[y][x] == Watts )
                {
                    EML = x * 5 ;
                    break ; 
                }
                else if(EM_CW[y][30] < Watts)
                {
                    EML = 30 * 5 ;
                    break;
                }
            }              
        }
        RetValue = EML ;
        
        if( B != 0 )
        {
            for( x = 0 ; x < 31 ; x++ )
            {
                if( EM_CW[y1][x] > Watts )
                {
                    if( x >= 1 )
                    {
                        EMH = ((x-1) * 5) + ((Watts-EM_CW[y1][(x-1)])/((EM_CW[y1][x]-EM_CW[y1][(x-1)])/5)) ;
                    }
                    else
                    {
                        EMH = 0 ;
                    }
                    break ; 
                }
                else
                {
                    if( EM_CW[y1][x] == Watts )
                    {
                        EMH = x * 5 ;
                        break ; 
                    }
                    else if( EM_CW[y1][30] < Watts )
                    {
                        EMH = 30 * 5 ;
                        break;
                    }
                }              
            }
            if( EML >= EMH )
                RetValue = EML - (EML-EMH) * (unsigned short)B / 5 ;
        }
    }  
    
    if( RetValue > 150 )
        RetValue = 150 ;
    return RetValue ;
}



/*******************************************************************************
* Function Name  : 
* Description    : 
* Input          : 
* Output         : 
* Return         : GE_CW
*******************************************************************************/
unsigned short Table_GeneratorCurrent2Watts(unsigned short Current,unsigned short Rpm)
{
    
    unsigned short RetValue = 0 ;
    unsigned char x,x1,y,y1;
    unsigned short WattsHihg,WattsLow ;
    unsigned char A,B  ;
    unsigned short vL,vH ;
    unsigned short GE_I ;
    //
    if( Current > 190 )
        GE_I = 190 ;
    else
        GE_I = Current ;
    //20130221
    y = 0 ;
    y1 = 0 ;
    x = 0 ;
    x1 = 0 ;
    vL = 0 ;
    vH = 0 ;
    //
    if( Rpm >= 25 )
    {
        if( Rpm > 140 )
            y = (140-25)/5 ;
        else  
        {
            y = (Rpm-25)/5 ;
            if( ((Rpm-25)%5) != 0 )
            {
                y1 = y+1 ;
                B = (Rpm-25)%5 ;
            }
        }
    }
    //
    x = GE_I / 5 ;
    if( (GE_I%5) != 0 )
    {
        x1 = x + 1 ;
        A = (GE_I%5) ;
    }
    WattsLow = GE_CW[y][x] ;
    WattsHihg = GE_CW[y][x1] ;
    if( x1 !=  0 )
    {
        if( WattsHihg > WattsLow )
        {
            vL = WattsLow + (unsigned short)((float)(WattsHihg-WattsLow)/5*A) ;
        }
        else
            vL = WattsLow ;
    }
    else
        vL = WattsLow ;
    
    if( y1 != 0 )
    {
        WattsLow = GE_CW[y1][x] ;
        WattsHihg = GE_CW[y1][x1] ;
        if( x1 !=  0 )
        {
            if( WattsHihg > WattsLow )
            {
                vH = WattsLow + (unsigned short)((float)(WattsHihg-WattsLow)/5*A) ;
            }
            else
                vH = WattsLow ;
        }
        else
            vH = WattsLow ;
        
        if( vH > vL )
            RetValue = vL + (unsigned short)((float)(vH-vL)/5*B) ;
        else
            RetValue = vL ;
    }
    else
    {
        RetValue = vL ; 
    }
    
    return RetValue ;
}





